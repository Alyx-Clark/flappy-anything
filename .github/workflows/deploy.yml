name: Deploy to cPanel
on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Pull latest on cPanel
        run: |
          RESPONSE=$(curl -s \
            -H "Authorization: cpanel owlexdev:${{ secrets.CPANEL_TOKEN }}" \
            "https://${{ secrets.CPANEL_HOST }}:2083/execute/VersionControl/update?repository_root=%2Fhome%2Fowlexdev%2Fpublic_html%2Fflappyanything&branch=master")
          echo "$RESPONSE"
          STATUS=$(echo "$RESPONSE" | jq -r '.status')
          if [ "$STATUS" != "1" ]; then
            echo "::error::cPanel update failed"
            exit 1
          fi
